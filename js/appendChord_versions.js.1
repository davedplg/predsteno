function appendChord_old(left,right){ 
  let leftLen  = left.length;      
  let rightLen = right.length;  
                                  
  if(leftLen==0) {                
    left    =right;                   
    leftLen =rightLen;          
    right   ="";}                    
                                
  let fragLen      = frag.length;      
  let isFragOdd    = fragLen % 2;    
  let fragLast     = frag.slice(-1);
// detect doubled digits  
  let rightIsDbl   = (right % 11 == 0);
  let leftIsDbl    = (left  % 11 == 0);
 

  // even cant follow odd unless it is a double 
  if(!isFragOdd && leftLen==1 && rightLen==2 && !rightIsDbl) return false; 
  if(isFragOdd  && leftLen==2 && !leftIsDbl)         return false; 
  if(fragLast < left || !isFragOdd ){
  frag = frag + left + right;
  } else {  //swap left and fragLast (i.e reorder)
    frag = frag.substring(0,fragLen-1) + left + fragLast  + right;
  } 
  if(!dic[frag]) frag="";
  return true;
}

function appendChord(leftChord, rightChord) {
  // Coerce inputs to strings to handle numbers or undefined
  let l = String(leftChord);   // Can be single or two-finger chord
  let r = String(rightChord);  // Can be single or two-finger chord
  
  // Base case: if left chord is empty, shift right to left
  if (l === "") { l = r; r = ""; }
  // Base case: if left chord is still empty, append nothing
  if (l === "") return true;
  
  let fragLen = frag.length || 1;
  let isFragOdd = fragLen % 2;
  let fragLast = frag.slice(-1);
  
  // Check for doubled digits (e.g., "55" = 5*11)
  let lNum = parseInt(l);
  let rNum = parseInt(r);
  let lIsDbl = lNum % 11 === 0;
  let rIsDbl = rNum % 11 === 0;
  
  // Reject: even frag + single left + non-doubled right (length 2)
  if (!isFragOdd && l.length === 1 && r.length === 2 && !rIsDbl) return false;
  // Reject: odd frag + non-doubled left (length 2)
  if (isFragOdd && l.length === 2 && !lIsDbl) return false;
  
  // Append: if frag is even or last char < left, append left + right
  if (!isFragOdd || fragLast < l) {
    frag += l + r;
  } else {
    // Swap left and last char, append right
    frag = frag.substring(0, fragLen - 1) + order(fragLast, l) + r;
  }
  
  // Reset frag if not in dictionary
  if (!dic[frag]) frag = "";
  return true;
}
